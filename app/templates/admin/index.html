{% extends "layouts/base.html" %}

{% block title %}Admin - ProfesionalTAP{% endblock %}

{% block content %}
<section class="page-section">
    <div class="container">
        <h1>Panel de Administración</h1>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number">{{ total }}</div>
                <div class="stat-label">Total pedidos</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ total_b2b }}</div>
                <div class="stat-label">Tarjetas B2B</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ total_b2c }}</div>
                <div class="stat-label">Landings B2C</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ total_users }}</div>
                <div class="stat-label">Usuarios</div>
            </div>
        </div>

        <!-- Per sector -->
        {% if sectors %}
        <div class="dashboard-card">
            <h2>Por sector</h2>
            <table class="table">
                <thead>
                    <tr>
                        <th>Sector</th>
                        <th>Pedidos</th>
                    </tr>
                </thead>
                <tbody>
                    {% for sector, count in sectors %}
                    <tr>
                        <td>{{ sector | upper }}</td>
                        <td>{{ count }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}

        <!-- Recent orders -->
        <div class="dashboard-card">
            <h2>Últimos pedidos</h2>
            <a href="{{ url_for('admin.orders') }}" class="btn btn-sm" style="margin-bottom:1rem;">Ver todos los pedidos</a>
            <table class="table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Tipo</th>
                        <th>Sector</th>
                        <th>Cliente</th>
                        <th>Negocio</th>
                        <th>Fecha</th>
                    </tr>
                </thead>
                <tbody>
                    {% for req in recent %}
                    <tr>
                        <td>#{{ req.id }}</td>
                        <td><span class="badge {{ 'badge-b2b' if req.is_b2b else 'badge-b2c' }}">{{ req.landing_type | upper }}</span></td>
                        <td>{{ req.sector | upper }}</td>
                        <td>{{ req.user.email }}</td>
                        <td>{{ req.business_name }}</td>
                        <td>{{ req.created_at.strftime('%d/%m/%Y %H:%M') }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</section>
{% endblock %}
