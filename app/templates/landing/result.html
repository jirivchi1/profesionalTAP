{% extends "layouts/base.html" %}

{% block title %}Tu QR - {{ req.contact_name }} - ProfesionalTAP{% endblock %}

{% block content %}
<section class="page-section">
    <div class="container">

        <!-- QR Code -->
        <div class="dashboard-card" style="text-align: center;">
            <h2>¡Tu perfil y QR están listos!</h2>
            <p class="text-light" style="margin-bottom:1.5rem;">
                Comparte este QR con tus clientes. Al escanearlo verán tu perfil y podrán dejarte sus datos.
            </p>
            {% if req.qr_code %}
            <img src="data:image/png;base64,{{ req.qr_code }}"
                 alt="Código QR de {{ req.contact_name }}"
                 style="width: 220px; height: 220px; display: block; margin: 0 auto 1rem; border-radius: 0.5rem;">
            <a href="data:image/png;base64,{{ req.qr_code }}"
               download="qr-{{ req.public_slug }}.png"
               class="btn"
               style="margin-bottom: 1rem;">
                Descargar QR
            </a>
            {% endif %}
            <p class="text-light" style="margin-top: 0.5rem;">
                Tu perfil público:
                <a href="{{ url_for('landing.public_view', slug=req.public_slug) }}" target="_blank">
                    /p/{{ req.public_slug }}
                </a>
            </p>
        </div>

        <!-- CTA account creation -->
        {% if is_mine %}
        <div class="dashboard-card" style="text-align: center;">
            <h2>Este QR ya está en tu dashboard</h2>
            <p class="text-light" style="margin-bottom:1.5rem;">
                Ve a tu dashboard para ver quién ha escaneado tu QR y enviarles un mensaje de seguimiento.
            </p>
            <a href="{{ url_for('dashboard.index') }}" class="btn">Ir a mi dashboard</a>
        </div>
        {% elif can_claim %}
        <div class="dashboard-card" style="text-align: center;">
            <h2>Añade este QR a tu dashboard</h2>
            <p class="text-light" style="margin-bottom:1.5rem;">
                Vincula este perfil a tu cuenta para gestionar los contactos y citas desde tu dashboard.
            </p>
            <form method="POST" action="{{ url_for('landing.claim', slug=req.public_slug) }}" style="display:inline;">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button type="submit" class="btn" style="margin-right: 0.5rem;">Añadir a mi dashboard</button>
            </form>
            <a href="{{ url_for('dashboard.index') }}" class="btn btn-outline">Ir al dashboard</a>
        </div>
        {% elif current_user.is_authenticated %}
        <div class="dashboard-card" style="text-align: center;">
            <h2>Gestiona tus contactos</h2>
            <p class="text-light" style="margin-bottom:1.5rem;">
                Ve a tu dashboard para ver quién ha escaneado tu QR y enviarles un mensaje de seguimiento.
            </p>
            <a href="{{ url_for('dashboard.index') }}" class="btn">Ir a mi dashboard</a>
        </div>
        {% else %}
        <div class="dashboard-card cta-card" style="text-align: center;">
            <h2>Guarda tu perfil y gestiona tus contactos</h2>
            <p class="text-light" style="margin-bottom:1rem;">Crea una cuenta gratuita para:</p>
            <ul class="cta-list">
                <li>Ver quién ha escaneado tu QR</li>
                <li>Recibir los datos de contacto de tus clientes</li>
                <li>Enviar mensajes de seguimiento personalizados</li>
                <li>Acceder a tu perfil desde cualquier dispositivo</li>
            </ul>
            <div>
                <a href="{{ url_for('auth.register', ref=req.public_slug) }}" class="btn" style="margin-right: 0.5rem;">
                    Crear cuenta gratis
                </a>
            </div>
            <p class="text-light" style="margin-top: 1rem; font-size: 0.9rem;">
                ¿Ya tienes cuenta?
                <a href="{{ url_for('auth.login') }}">Iniciar sesión</a>
            </p>
        </div>
        {% endif %}

        <!-- Community invite -->
        <div class="community-card" style="border-color: {{ theme.primary }};">
            <div class="community-icon">{{ theme.icon }}</div>
            <h2>Únete a la comunidad {{ theme.community }}</h2>
            <p>{{ theme.community_desc }}</p>
            <ul class="community-perks">
                <li>Acceso a la red de profesionales de tu sector</li>
                <li>Visibilidad en nuestro directorio</li>
                <li>Ofertas y recursos exclusivos</li>
            </ul>
            <a href="{{ url_for('auth.register', comunidad=req.sector, ref=req.public_slug) }}"
               class="btn btn-community"
               style="background: {{ theme.primary }};">
                Unirme a {{ theme.community }}
            </a>
            <p class="community-note">Registro gratuito. Sin compromiso.</p>
        </div>

    </div>
</section>
{% endblock %}
