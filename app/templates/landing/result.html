{% extends "layouts/base.html" %}

{% block title %}Tu QR - {{ req.contact_name }} - ProfesionalTAP{% endblock %}

{% block content %}
<section class="page-section">
    <div class="container">

        <!-- QR Code -->
        <div class="dashboard-card" style="text-align: center;">
            <h2>¡Tu perfil y QR están listos!</h2>
            <p style="color:#6b7280; margin-bottom:1.5rem;">
                Comparte este QR con tus clientes. Al escanearlo verán tu perfil y podrán dejarte sus datos.
            </p>
            {% if req.qr_code %}
            <img src="data:image/png;base64,{{ req.qr_code }}"
                 alt="Código QR de {{ req.contact_name }}"
                 style="width: 220px; height: 220px; display: block; margin: 0 auto 1rem;">
            <a href="data:image/png;base64,{{ req.qr_code }}"
               download="qr-{{ req.public_slug }}.png"
               class="btn"
               style="display: inline-block; margin-bottom: 1rem;">
                Descargar QR
            </a>
            {% endif %}
            <p style="font-size:0.85rem; color:#9ca3af;">
                Tu perfil público:
                <a href="{{ url_for('landing.public_view', slug=req.public_slug) }}" target="_blank">
                    /p/{{ req.public_slug }}
                </a>
            </p>
        </div>

        <!-- CTA account creation -->
        {% if current_user.is_authenticated %}
        <div class="dashboard-card" style="text-align: center;">
            <h2>Gestiona tus contactos</h2>
            <p style="color:#6b7280; margin-bottom:1.5rem;">
                Ve a tu dashboard para ver quién ha escaneado tu QR y enviarles un mensaje de seguimiento.
            </p>
            <a href="{{ url_for('dashboard.index') }}" class="btn">Ir a mi dashboard</a>
        </div>
        {% else %}
        <div class="dashboard-card" style="text-align: center; border-left: 4px solid #3b82f6;">
            <h2>Guarda tu perfil y gestiona tus contactos</h2>
            <p style="color:#6b7280; margin-bottom:1rem;">
                Crea una cuenta gratuita para:
            </p>
            <ul style="text-align:left; display:inline-block; margin-bottom:1.5rem; color:#374151;">
                <li>Ver quién ha escaneado tu QR</li>
                <li>Recibir los datos de contacto de tus clientes</li>
                <li>Enviar mensajes de seguimiento personalizados</li>
                <li>Acceder a tu perfil desde cualquier dispositivo</li>
            </ul>
            <div>
                <a href="{{ url_for('auth.register', ref=req.public_slug) }}" class="btn" style="margin-right: 0.5rem;">
                    Crear cuenta gratis
                </a>
            </div>
            <p style="margin-top: 1rem; font-size: 0.9rem; color:#6b7280;">
                ¿Ya tienes cuenta?
                <a href="{{ url_for('auth.login') }}" style="color:#3b82f6;">Iniciar sesión</a>
            </p>
        </div>
        {% endif %}

        <!-- Community invite -->
        <div class="community-card" style="border-color: {{ theme.primary }};">
            <div class="community-icon">{{ theme.icon }}</div>
            <h2>Únete a la comunidad {{ theme.community }}</h2>
            <p>{{ theme.community_desc }}</p>
            <ul class="community-perks">
                <li>Acceso a la red de profesionales de tu sector</li>
                <li>Visibilidad en nuestro directorio</li>
                <li>Ofertas y recursos exclusivos</li>
            </ul>
            <a href="{{ url_for('auth.register', comunidad=req.sector, ref=req.public_slug) }}"
               class="btn btn-community"
               style="background: {{ theme.primary }};">
                Unirme a {{ theme.community }}
            </a>
            <p class="community-note">Registro gratuito. Sin compromiso.</p>
        </div>

    </div>
</section>
{% endblock %}
